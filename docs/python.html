<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python SDK - AVP Documentation</title>
    <link rel="icon" href="../assets/avp-icon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .docs-container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        .back-link { display: inline-flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); text-decoration: none; margin-bottom: 2rem; }
        .back-link:hover { color: var(--accent); }
        h1 { color: var(--text-primary); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
        h2 { color: var(--accent); margin-top: 2.5rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; }
        h3 { color: var(--text-primary); margin-top: 1.5rem; }
        p, li { color: var(--text-secondary); line-height: 1.7; }
        pre { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; overflow-x: auto; margin: 1rem 0; }
        code { font-family: 'Fira Code', 'SF Mono', Monaco, monospace; font-size: 0.9rem; color: var(--accent); }
        pre code { color: var(--text-primary); }
        .method { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; margin: 1rem 0; }
        .method-signature { font-family: monospace; color: var(--accent); font-size: 0.95rem; margin-bottom: 0.5rem; }
        .method p { margin: 0.5rem 0; }
        .param { color: #f9a825; }
        .type { color: #4fc3f7; }
        .badge { display: inline-block; padding: 0.2rem 0.5rem; background: rgba(0, 212, 170, 0.2); color: var(--accent); border-radius: 4px; font-size: 0.8rem; margin-left: 0.5rem; }
    </style>
</head>
<body>
    <div class="docs-container">
        <a href="index.html" class="back-link">← Back to Docs</a>

        <h1><img src="../img/python.svg" width="32" alt="Python"> Python SDK Reference</h1>
        <p>Complete API documentation for <code>avp-sdk</code></p>

        <h2>Installation</h2>
<pre><code># Basic installation
pip install avp-sdk

# With OS keychain support
pip install avp-sdk[keychain]

# Development with all features
pip install avp-sdk[all]</code></pre>

        <h2>Quick Example</h2>
<pre><code>from avp import AVPClient
from avp.backends import FileBackend, KeychainBackend

# File backend (encrypted storage)
backend = FileBackend("~/.avp/vault.enc", "password")

# Or use OS keychain (macOS/Linux/Windows)
# backend = KeychainBackend()

client = AVPClient(backend)
session = client.authenticate(workspace="my-agent")

# Store, retrieve, list, delete
client.store(session.session_id, "api_key", b"secret-value")
result = client.retrieve(session.session_id, "api_key")
print(result.value.decode())  # "secret-value"</code></pre>

        <h2>AVPClient</h2>
        <p>Main client for interacting with AVP backends.</p>

        <div class="method">
            <div class="method-signature">AVPClient(<span class="param">backend</span>: <span class="type">BackendBase</span>)</div>
            <p>Create a new AVP client with the specified backend.</p>
        </div>

        <h3>Methods</h3>

        <div class="method">
            <div class="method-signature">discover() → <span class="type">DiscoverResponse</span></div>
            <p>Discover vault capabilities, backends, and limits.</p>
<pre><code>info = client.discover()
print(f"Version: {info.version}")
print(f"Backends: {[b.id for b in info.backends]}")</code></pre>
        </div>

        <div class="method">
            <div class="method-signature">authenticate(<span class="param">workspace</span>: <span class="type">str</span>, <span class="param">ttl_seconds</span>: <span class="type">int</span> = 3600) → <span class="type">Session</span></div>
            <p>Authenticate and create a session for a workspace.</p>
<pre><code>session = client.authenticate(workspace="production", ttl_seconds=7200)
print(f"Session ID: {session.session_id}")</code></pre>
        </div>

        <div class="method">
            <div class="method-signature">store(<span class="param">session_id</span>: <span class="type">str</span>, <span class="param">name</span>: <span class="type">str</span>, <span class="param">value</span>: <span class="type">bytes</span>, <span class="param">labels</span>: <span class="type">dict</span> = None) → <span class="type">StoreResponse</span></div>
            <p>Store a credential in the vault.</p>
<pre><code>result = client.store(
    session.session_id,
    "openai_api_key",
    b"sk-...",
    labels={"env": "production", "service": "chat"}
)
print(f"Created: {result.created}, Version: {result.version}")</code></pre>
        </div>

        <div class="method">
            <div class="method-signature">retrieve(<span class="param">session_id</span>: <span class="type">str</span>, <span class="param">name</span>: <span class="type">str</span>) → <span class="type">RetrieveResponse</span></div>
            <p>Retrieve a credential from the vault.</p>
<pre><code>result = client.retrieve(session.session_id, "openai_api_key")
api_key = result.value.decode()
print(f"Version: {result.version}")</code></pre>
        </div>

        <div class="method">
            <div class="method-signature">delete(<span class="param">session_id</span>: <span class="type">str</span>, <span class="param">name</span>: <span class="type">str</span>) → <span class="type">DeleteResponse</span></div>
            <p>Delete a credential from the vault.</p>
<pre><code>result = client.delete(session.session_id, "old_api_key")
print(f"Deleted: {result.deleted}")</code></pre>
        </div>

        <div class="method">
            <div class="method-signature">list_secrets(<span class="param">session_id</span>: <span class="type">str</span>, <span class="param">filter_labels</span>: <span class="type">dict</span> = None) → <span class="type">ListResponse</span></div>
            <p>List all credentials in the workspace.</p>
<pre><code># List all
result = client.list_secrets(session.session_id)
for secret in result.secrets:
    print(f"  {secret.name}: v{secret.metadata.version}")

# Filter by labels
prod_secrets = client.list_secrets(
    session.session_id,
    filter_labels={"env": "production"}
)</code></pre>
        </div>

        <div class="method">
            <div class="method-signature">rotate(<span class="param">session_id</span>: <span class="type">str</span>, <span class="param">name</span>: <span class="type">str</span>, <span class="param">new_value</span>: <span class="type">bytes</span>) → <span class="type">RotateResponse</span></div>
            <p>Rotate a credential with version tracking.</p>
<pre><code>result = client.rotate(session.session_id, "api_key", b"new-secret")
print(f"New version: {result.version}")</code></pre>
        </div>

        <h2>Backends</h2>

        <h3>MemoryBackend</h3>
        <p>In-memory storage for testing. <span class="badge">Testing Only</span></p>
<pre><code>from avp.backends import MemoryBackend
backend = MemoryBackend()</code></pre>

        <h3>FileBackend</h3>
        <p>Encrypted file storage using Fernet (AES-128-CBC + HMAC).</p>
<pre><code>from avp.backends import FileBackend
backend = FileBackend(
    path="~/.avp/vault.enc",
    password="your-secure-password"
)</code></pre>

        <h3>KeychainBackend</h3>
        <p>OS-native credential storage (requires <code>pip install avp-sdk[keychain]</code>).</p>
<pre><code>from avp.backends import KeychainBackend
backend = KeychainBackend()  # Uses macOS Keychain, Windows Cred Manager, or SecretService</code></pre>

        <h2>Error Handling</h2>
<pre><code>from avp.errors import SecretNotFoundError, SessionExpiredError

try:
    result = client.retrieve(session.session_id, "missing_key")
except SecretNotFoundError:
    print("Credential not found")
except SessionExpiredError:
    # Re-authenticate
    session = client.authenticate(workspace="my-agent")</code></pre>

        <h2>Context Manager</h2>
<pre><code># Automatic cleanup
with AVPClient(backend) as client:
    session = client.authenticate(workspace="temp")
    client.store(session.session_id, "key", b"value")
# Backend closed automatically</code></pre>

        <footer style="text-align: center; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border);">
            <p style="color: var(--text-secondary);">
                <a href="https://github.com/avp-protocol/avp-py" style="color: var(--accent);">View on GitHub</a> ·
                <a href="https://pypi.org/project/avp-sdk/" style="color: var(--accent);">PyPI</a>
            </p>
        </footer>
    </div>
</body>
</html>
